# Планировщик роботов-манипуляторов

Система планирования совместной работы нескольких промышленных роботов-манипуляторов с обеспечением безопасности и минимизацией времени выполнения.

## Быстрый старт

### 1. Установка зависимостей

```bash
pip install ortools numpy flask flask-cors
```

### 2. Запуск веб-приложения

```bash
cd web
python server.py

```

Откройте http://localhost:5000 в браузере.

### 3. Использование

1. **Загрузка сценария**: Нажмите "Load scenario file" или "Load Examples"
2. **Запуск планировщика**: Нажмите "Run Scheduler"
3. **Визуализация**: Результат автоматически загрузится в визуализатор
4. **Анимация**: Используйте кнопки Play/Pause для просмотра движения роботов

## Структура проекта

```
scheduler_demo/
├── src/                          # Исходный код планировщика
│   ├── scheduler_integrated.py   # Основной планировщик
│   ├── parser.py                 # Парсер входных/выходных данных
│   ├── collision_checker.py      # Проверка коллизий
│   └── inverse_kinematics.py     # Обратная кинематика
├── web/                          # Веб-интерфейс
│   ├── visualizer.html           # Визуализатор траекторий
│   └── server.py                 # Flask сервер
├── scenarios/                    # Тестовые сценарии
│   ├── triangle_test.txt         # Треугольное расположение роботов
│   ├── own_base_return_test.txt  # Возврат на свои базы
│   ├── complex_test.txt          # Сложный многоуровневый сценарий
│   ├── warehouse_test.txt        # Складской сценарий
│   └── multi_level_test.txt      # Многоуровневый склад
├── output/                       # Результаты планирования
├── ros2_ws/                      # ROS2 workspace (исключен из Docker)
├── Dockerfile                    # Конфигурация Docker
├── docker-compose.yml            # Оркестрация контейнеров
├── requirements.txt              # Python зависимости
└── README.md
```

## Основные функции

### Реализованные возможности:

1. **Парсинг входных данных** - полная поддержка формата ТЗ
2. **Оптимизация назначения операций** - CP-SAT решатель Google OR-Tools
3. **Планирование траекторий** - учет кинематических ограничений (V_max, A_max)
4. **Проверка коллизий** - аналитический расчет минимальных расстояний
5. **Обратная кинематика** - базовая проверка достижимости точек
6. **Веб-визуализация** - анимация движения роботов в реальном времени
7. **Веб-сервер** - API для интеграции планировщика с интерфейсом
8. **Docker-контейнеризация** - изолированное развертывание
9. **Оптимизация производительности** - улучшенные алгоритмы очередей и коллизий

### Визуализатор включает:

- Анимация движения TCP роботов
- Отображение траекторий и waypoints
- Зоны безопасности с настраиваемым радиусом
- Временная шкала с управлением воспроизведением
- Проверка коллизий в реальном времени
- Навигация по сцене (масштабирование, панорамирование)

## Результаты тестирования

| Сценарий | Роботы | Операции | Время выполнения | Особенности |
|----------|--------|----------|------------------|-------------|
| triangle_test.txt | 3 | 6 | 76811 мс | Базовый треугольный сценарий |
| own_base_return_test.txt | 3 | 18 | 161912 мс | Возврат на свои базы |
| complex_test.txt | 3 | 9 | 270472 мс | Сложный многоуровневый |
| warehouse_test.txt | 3 | 6 | 113811 мс | Складской сценарий |
| multi_level_test.txt | 3 | 6 | 113811 мс | Многоуровневый склад |

## Использование из командной строки

```bash
# Планировщик
python src/scheduler_integrated.py scenarios/triangle_test.txt output.txt

# Проверка обратной кинематики
python src/inverse_kinematics.py
```

## Docker-контейнеризация

### Сборка и запуск

```bash
# Сборка образа
docker build -t scheduler-demo .

# Запуск веб-интерфейса (все сценарии доступны через браузер)

# Для Linux/macOS:
docker run -p 5000:5000 -v $(pwd)/scenarios:/app/scenarios:ro -v $(pwd)/output:/app/output scheduler-demo

# Для Windows (замените C:\Users\Olegk\Downloads\scheduler_demo на ваш путь):
docker run -p 5000:5000 -v "C:\Users\Olegk\Downloads\scheduler_demo\scenarios:/app/scenarios:ro" -v "C:\Users\Olegk\Downloads\scheduler_demo\output:/app/output" scheduler-demo
```

После запуска откройте http://localhost:5000 в браузере для работы с планировщиком.

### Использование Makefile

```bash
make build    # Сборка образа
make run      # Запуск веб-интерфейса
make clean    # Очистка Docker ресурсов
```

## Формат входных данных

```
K N
x1 y1 z1
x2 y2 z2
...
xK yK zK
J1_min J1_max V1_max A1_max
...
J6_min J6_max V6_max A6_max
Tool_clearance Safe_dist
Px_pick Py_pick Pz_pick Px_place Py_place Pz_place t_i
...
```

Где:
- K - количество роботов
- N - количество операций
- (xi, yi, zi) - позиции оснований роботов
- Ji_min, Ji_max - ограничения углов суставов
- Vi_max, Ai_max - максимальные скорость и ускорение
- Tool_clearance - размер инструмента
- Safe_dist - безопасное расстояние между роботами

## Формат выходных данных

```
makespan
R0 m0
t11 x y z
...
R1 m1
...
```

Где:
- makespan - общее время выполнения всех операций
- Ri - идентификатор робота
- mi - количество waypoints для робота i
- tij - время и координаты j-го waypoint робота i

## Технические детали

- **Планировщик**: CP-SAT (Constraint Programming) с Google OR-Tools
- **Коллизии**: Аналитический расчет расстояний между отрезками с оптимизацией
- **Кинематика**: Трапецеидальный профиль скорости
- **Веб-сервер**: Flask + CORS
- **Визуализация**: HTML5 Canvas + JavaScript
- **Контейнеризация**: Docker с исключением ROS2 workspace
- **Оптимизация**: Улучшенные алгоритмы очередей и проверки коллизий

## Оптимизации производительности

1. **Оптимизация очередей** - сокращение времени ожидания доступа к общим ресурсам
2. **Ускорение проверки коллизий** - пошаговая проверка с ранним выходом
3. **Сокращение времени операций** - уменьшение deadline для ускорения выполнения
4. **Условное создание очередей** - только для точек с множественными операциями

## Ограничения

1. Упрощенная модель обратной кинематики
2. Базовое обнаружение коллизий (без устранения)
3. Приближенный расчет времени движения
4. Ограниченная поддержка сложных сценариев с большим количеством роботов

## Возможности развития

1. Алгоритмы избежания коллизий
2. Более точная модель кинематики робота
3. Временная синхронизация траекторий
4. Оптимизация маршрутов
5. Поддержка более сложных сценариев
6. Интеграция с ROS2
7. Машинное обучение для оптимизации планирования

## Поддержка

При возникновении проблем:
1. Проверьте установку всех зависимостей
2. Убедитесь, что порт 5000 свободен
3. Проверьте логи сервера в консоли
4. Для Docker: убедитесь, что Docker запущен и имеет доступ к файлам

---

**Статус проекта**: Готов к демонстрации и дальнейшему развитию
